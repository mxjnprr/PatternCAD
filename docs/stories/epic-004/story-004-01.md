# Story 004-01: Add seam allowance automatically

**Epic:** EPIC-004 - Professional Pattern Features
**Status:** Not Started
**Estimate:** 8 points
**Assigned To:** Unassigned

---

## Description

As a pattern designer, I want to automatically add seam allowance around pattern piece edges
so that I don't have to manually offset every edge.

---

## Acceptance Criteria

- [ ] User can specify seam allowance width (mm, cm, inches)
- [ ] Seam allowance is added as offset outline around pattern piece
- [ ] Corner handling options: miter, round, bevel
- [ ] User can exclude specific edges from seam allowance
- [ ] Seam allowance is visually distinct (different line style/color)
- [ ] Seam allowance updates automatically if pattern shape changes
- [ ] Seam allowance can be toggled on/off per pattern

---

## Technical Notes

**Offset Algorithm:**
- Use Clipper library or Boost.Geometry for polygon offsetting
- Handle complex cases: concave corners, self-intersections
- Support different corner types: miter (sharp), round (arc), bevel (flat)

**SeamAllowance Class:**
```cpp
class SeamAllowance {
    Pattern* pattern;
    double width;  // in current units
    CornerType cornerType;
    std::set<Edge*> excludedEdges;

    Polygon computeOffset() {
        Polygon outline = pattern->getOutline();

        // Remove excluded edges from offset calculation
        for (Edge* edge : excludedEdges) {
            outline.markEdgeExcluded(edge);
        }

        // Perform offset using Clipper
        ClipperLib::ClipperOffset offset;
        offset.AddPath(outline, cornerType, ClipperLib::etClosedPolygon);

        Polygon result;
        offset.Execute(result, width);
        return result;
    }

    void render(QPainter& painter) {
        Polygon offset = computeOffset();
        painter.setPen(QPen(Qt::DashLine));
        painter.setBrush(Qt::NoBrush);
        painter.drawPolygon(offset);
    }
};
```

**UI Integration:**
- Properties panel for pattern
- Seam allowance section with:
  - Width input field (with unit selector)
  - Corner type dropdown
  - "Exclude Edge" tool (click edges to exclude)
  - "Show Seam Allowance" checkbox

**Observer Pattern:**
- SeamAllowance observes Pattern geometry
- When pattern changes, seam allowance recomputes automatically

---

## Dependencies

None (standalone feature)

---

## Definition of Done

- [ ] SeamAllowance class implemented
- [ ] Offset algorithm working (using Clipper or Boost)
- [ ] Corner types working (miter, round, bevel)
- [ ] Edge exclusion working
- [ ] Automatic updates when pattern changes
- [ ] Visual rendering (dashed line)
- [ ] UI integration (properties panel)
- [ ] Unit tests for offset calculations
- [ ] Integration tests with pattern editing
- [ ] Documentation updated
- [ ] Merged to main branch
