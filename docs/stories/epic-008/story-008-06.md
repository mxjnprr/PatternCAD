# Story 008-06: Create parameters panel

**Epic:** EPIC-008 - User Interface and Cross-Platform Foundation
**Status:** Not Started
**Estimate:** 5 points
**Assigned To:** Unassigned

---

## Description

As a pattern designer, I want a parameters panel to view and edit all parameters
so that I can manage parametric dimensions.

---

## Acceptance Criteria

- [ ] Parameters panel is dockable widget
- [ ] Panel shows all defined parameters in table format
- [ ] Columns: Name, Value, Unit, Expression, Group
- [ ] User can edit parameters inline
- [ ] User can add, delete parameters
- [ ] Panel shows parameter dependencies (which params use which)
- [ ] Panel can be hidden/shown (View menu)
- [ ] Panel updates when parameters change

---

## Technical Notes

**Implementation Details:**
- Implement ParametersPanel (QDockWidget)
- Use QTableWidget or custom model/view
- Connect to ParametricEngine
- Implement inline editing
- Show dependency information

**Key Components:**
```cpp
class ParametersPanel : public QDockWidget {
    Q_OBJECT
public:
    explicit ParametersPanel(QWidget *parent = nullptr);

    void setParametricEngine(ParametricEngine* engine);
    void refreshParameters();

signals:
    void parameterCreated(const QString& name);
    void parameterDeleted(const QString& name);
    void parameterValueChanged(const QString& name, double value);
    void parameterExpressionChanged(const QString& name, const QString& expr);

private slots:
    void onAddParameter();
    void onDeleteParameter();
    void onParameterEdited(int row, int column);
    void onShowDependencies();
    void onContextMenu(const QPoint& pos);

private:
    void createUI();
    void populateTable();
    void validateParameterName(const QString& name);
    void validateParameterExpression(const QString& expr);

    QTableWidget* paramTable_;
    ParametricEngine* engine_;
    QPushButton* addBtn_;
    QPushButton* deleteBtn_;
    QPushButton* showDepsBtn_;
};
```

**Table Structure:**

| Name | Value | Unit | Expression | Group | Used By |
|------|-------|------|------------|-------|---------|
| waist_width | 80.0 | cm | | Measurements | front_width, back_width |
| front_width | 40.0 | cm | waist_width / 2 | Calculated | |
| seam_allowance | 1.5 | cm | | Settings | |

**Columns:**
1. **Name:** Editable, unique identifier, alphanumeric + underscore
2. **Value:** Editable, numeric with units, computed from expression if present
3. **Unit:** Dropdown (mm, cm, inches), editable
4. **Expression:** Editable, formula string (e.g., "waist_width / 2 + 1.5")
5. **Group:** Editable, category/organization (optional)
6. **Used By:** Read-only, shows dependent parameters (comma-separated)

**Inline Editing:**
- Double-click cell to edit
- Enter/Return confirms edit
- Escape cancels edit
- Tab moves to next cell
- Validation on edit: Show error icon if invalid

**Parameter Addition:**
- Click "+" button
- New row added with default values
- Name: "parameter_N" (auto-increment)
- Value: 0.0
- Unit: Default project unit
- Focus on Name field for immediate edit

**Parameter Deletion:**
- Select row(s) and click "-" button
- Confirm if parameter is used by others
- Show warning: "Parameter 'waist_width' is used by: front_width, back_width. Delete anyway?"

**Validation:**
```cpp
bool validateParameterName(const QString& name) {
    // Must be alphanumeric + underscore
    // Must start with letter or underscore
    // Must be unique
    QRegularExpression re("^[a-zA-Z_][a-zA-Z0-9_]*$");
    return re.match(name).hasMatch() && !parameterExists(name);
}

bool validateExpression(const QString& expr) {
    // Parse expression and check for circular dependencies
    // Check that all referenced parameters exist
    try {
        ExpressionParser parser(expr);
        parser.validate();
        return !hasCircularDependency(expr);
    } catch (const std::exception& e) {
        showError(e.what());
        return false;
    }
}
```

**Dependency Visualization:**
- "Used By" column shows direct dependents
- "Show Dependencies" button opens dependency graph dialog
- Graph shows all parameters and their relationships
- Highlight circular dependencies in red

**Context Menu:**
- **Add Parameter:** Same as "+" button
- **Delete Parameter:** Same as "-" button
- **Duplicate Parameter:** Create copy with "_copy" suffix
- **Show Dependencies:** Open dependency graph
- **Copy Name:** Copy parameter name to clipboard (for use in expressions)
- **Copy Value:** Copy parameter value to clipboard

**Parameter Grouping:**
- Group column allows categorization
- Groups: "Measurements", "Calculated", "Settings", "Custom"
- Can expand/collapse groups in tree view mode (optional)

**Search/Filter:**
- Search box filters parameters by name
- Real-time filtering as user types
- Clear button to reset filter

---

## Dependencies

- story-008-01 (Main window must exist)

---

## Definition of Done

- [ ] Code implemented and committed
- [ ] Unit tests written and passing
- [ ] Integration tests passing
- [ ] Code reviewed and approved
- [ ] Documentation updated
- [ ] Manual testing completed
- [ ] No critical or high-priority bugs
- [ ] Acceptance criteria verified
- [ ] Expression validation working correctly
- [ ] Dependency tracking functional
- [ ] Panel updates in real-time when parameters change
