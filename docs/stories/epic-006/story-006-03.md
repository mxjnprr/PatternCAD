# Story 006-03: Measure perimeter and area of shapes

**Epic:** EPIC-006 - Measurement and Dimensioning
**Status:** Not Started
**Estimate:** 5 points
**Assigned To:** Unassigned

---

## Description

As a pattern designer, I want to measure perimeter and area of pattern pieces
so that I can calculate material requirements and verify sizes.

---

## Acceptance Criteria

- [ ] User can measure perimeter of closed shapes automatically
- [ ] User can measure area of closed shapes (polygons, complex curves)
- [ ] Perimeter calculation handles curves accurately (not just straight segments)
- [ ] Area calculation handles curves accurately (numerical integration)
- [ ] Area displays in current unit² (mm², cm², inch²)
- [ ] Measurements can be saved to Measurement panel

---

## Technical Notes

**Perimeter Calculation:**
```cpp
double calculatePerimeter(Pattern* pattern) {
    double perimeter = 0.0;

    // Sum length of all edges in pattern outline
    for (Edge* edge : pattern->getOutlineEdges()) {
        if (Line* line = dynamic_cast<Line*>(edge)) {
            perimeter += line->length();
        } else if (CubicBezier* curve = dynamic_cast<CubicBezier*>(edge)) {
            // Numerical integration for arc length
            perimeter += curve->arcLength();
        } else if (Arc* arc = dynamic_cast<Arc*>(edge)) {
            perimeter += arc->length();
        }
    }

    return perimeter;
}
```

**Area Calculation (Green's Theorem):**
```cpp
double calculateArea(Pattern* pattern) {
    // For closed polygon, use Green's theorem:
    // Area = 0.5 * |sum((x_i * y_{i+1}) - (x_{i+1} * y_i))|

    // Convert pattern to polygon by sampling curves
    std::vector<Point2D> points = pattern->toPolygon(/* segments */ 100);

    double area = 0.0;
    for (size_t i = 0; i < points.size(); i++) {
        Point2D p1 = points[i];
        Point2D p2 = points[(i + 1) % points.size()];

        area += (p1.x * p2.y) - (p2.x * p1.y);
    }

    return std::abs(area) / 2.0;
}
```

**Alternative: Triangulation Method:**
```cpp
double calculateAreaTriangulation(Pattern* pattern) {
    // Triangulate pattern using ear clipping or Delaunay
    std::vector<Triangle> triangles = triangulate(pattern->getOutline());

    double totalArea = 0.0;
    for (const Triangle& tri : triangles) {
        totalArea += tri.area();
    }

    return totalArea;
}
```

**PerimeterAreaMeasurement:**
```cpp
class PerimeterAreaMeasurement : public Measurement {
    Pattern* pattern;
    double perimeter;
    double area;

    void calculate() {
        perimeter = calculatePerimeter(pattern);
        area = calculateArea(pattern);
    }

    QString getDisplayValue() const {
        Unit unit = project->getUnit();
        QString perimStr = formatDistance(perimeter, unit);
        QString areaStr = formatArea(area, unit);

        return QString("Perimeter: %1\nArea: %2")
                   .arg(perimStr)
                   .arg(areaStr);
    }
};
```

**UI Integration:**
- Click on pattern with Measure tool → Show perimeter and area
- Display in properties panel or floating tooltip
- Add to Measurements panel

**Unit Formatting:**
- Perimeter: "125.5 cm"
- Area: "450.2 cm²" or "0.045 m²"

---

## Dependencies

- story-006-01: Measure tool foundation

---

## Definition of Done

- [ ] Perimeter calculation implemented (with curve support)
- [ ] Area calculation implemented (Green's theorem or triangulation)
- [ ] Accurate handling of Bezier curves
- [ ] Unit conversion for area (unit²)
- [ ] UI display of perimeter and area
- [ ] Integration with Measurement panel
- [ ] Unit tests for calculations
- [ ] Integration tests
- [ ] Documentation updated
- [ ] Merged to main branch
