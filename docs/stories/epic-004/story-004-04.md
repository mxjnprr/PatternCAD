# Story 004-04: Define size grading rules

**Epic:** EPIC-004 - Professional Pattern Features
**Status:** Not Started
**Estimate:** 5 points
**Assigned To:** Unassigned

---

## Description

As a pattern designer, I want to define grading rules for multiple sizes
so that I can specify how patterns scale across size range.

---

## Acceptance Criteria

- [ ] User can define size range (e.g., XS, S, M, L, XL)
- [ ] User can specify base size (e.g., M)
- [ ] User can define grading rules: which parameters change per size
- [ ] Grading rules specify increments (e.g., +2cm waist per size)
- [ ] User can define different increments for different dimensions
- [ ] Grading rules are saved with project

---

## Technical Notes

**GradeRule Class:**
```cpp
class GradeRule {
    QString parameterName;   // e.g., "waist_width", "shoulder_length"
    QMap<QString, double> increments;  // Size -> Increment

    // Example:
    // parameterName = "waist_width"
    // increments = {
    //     "XS": -4.0,   // -4cm from base
    //     "S": -2.0,    // -2cm from base
    //     "M": 0.0,     // base size (no change)
    //     "L": 2.0,     // +2cm from base
    //     "XL": 4.0     // +4cm from base
    // }
};

class GradingSystem {
    QString baseSize;            // e.g., "M"
    QStringList sizes;           // ["XS", "S", "M", "L", "XL"]
    std::vector<GradeRule> rules;

    double getParameterValue(const QString& paramName,
                            const QString& size) {
        double baseValue = getBaseParameterValue(paramName);
        GradeRule* rule = findRule(paramName);

        if (rule) {
            return baseValue + rule->increments[size];
        }
        return baseValue;  // No grading rule, use base value
    }
};
```

**UI - Grading Rules Dialog:**
```
┌─ Grading Rules ────────────────────────────┐
│ Base Size: [M ▼]                           │
│ Size Range: [XS] [S] [M] [L] [XL]         │
│                                             │
│ ┌─ Grading Rules ─────────────────────┐   │
│ │ Parameter      XS    S    M    L   XL│   │
│ │ waist_width   -4   -2    0   +2  +4 │   │
│ │ hip_width     -5   -2.5  0   +2.5+5 │   │
│ │ shoulder      -1   -0.5  0   +0.5+1 │   │
│ │ [Add Rule...]                        │   │
│ └──────────────────────────────────────┘   │
│                                             │
│ [Save] [Cancel]                            │
└─────────────────────────────────────────────┘
```

**Validation:**
- Ensure base size is in size range
- Ensure base size increment is 0
- Warn if parameter doesn't exist in pattern
- Validate that increments are numeric

---

## Dependencies

- story-002-01: Define and edit parameters (parametric dimensions)

---

## Definition of Done

- [ ] GradeRule and GradingSystem classes implemented
- [ ] Grading rules UI dialog implemented
- [ ] Size range configuration working
- [ ] Parameter-to-rule mapping working
- [ ] Grading rules saved/loaded with project
- [ ] Validation working
- [ ] Unit tests for grading calculations
- [ ] Integration tests with UI
- [ ] Documentation updated
- [ ] Merged to main branch
