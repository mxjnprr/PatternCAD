# Story 007-04: Auto-save with background saving

**Epic:** EPIC-007 - File Operations and Interoperability
**Status:** Not Started
**Estimate:** 8 points
**Assigned To:** Unassigned

---

## Description

As a pattern designer, I want automatic background saving so that my work is protected from crashes or power loss.

---

## Acceptance Criteria

- [ ] Auto-save is enabled by default (can be disabled in preferences)
- [ ] Auto-save interval is configurable: 1, 2, 5, 10, 15, 30 minutes (default: 5 min)
- [ ] Auto-save runs in background thread (non-blocking)
- [ ] User can continue working during auto-save
- [ ] Auto-save only happens if document has unsaved changes
- [ ] Auto-save creates separate file: {projectname}-{timestamp}.autosave
- [ ] System keeps last 5-10 auto-save versions (configurable)
- [ ] Status bar shows "Auto-saved" notification briefly
- [ ] Auto-save is fast: < 500ms for typical project

---

## Technical Notes

### Implementation Details

- Implement AutoSaveManager class
- Use QTimer for periodic trigger
- Save in QThread to avoid blocking UI
- Create timestamped auto-save files
- Implement FIFO cleanup (keep last N versions)
- Show notification in status bar

### Architecture

The auto-save system should:
1. Check for unsaved changes periodically via QTimer
2. If changes detected, spawn background thread
3. Clone current project state (shallow copy where possible)
4. Serialize and write to timestamped file
5. Clean up old auto-save files (keep last N)
6. Update UI with brief notification

### Thread Safety

- Use Qt's thread-safe signal/slot mechanism
- Clone project data before passing to background thread
- Ensure no race conditions with user edits
- Handle case where auto-save is in progress when user saves manually

### File Naming

- Format: `{basename}-{YYYYMMDD-HHMMSS}.autosave`
- Example: `mypattern-20260127-143022.autosave`

---

## Dependencies

- story-007-02 (Save project to native format)

---

## Definition of Done

- [ ] Code implemented and follows project coding standards
- [ ] Unit tests written and passing
- [ ] Integration tests verify auto-save functionality
- [ ] Manual testing completed on Linux and Windows
- [ ] Background saving doesn't block UI
- [ ] Auto-save timing is accurate
- [ ] Old files cleanup works correctly
- [ ] Thread safety verified (no race conditions)
- [ ] Documentation updated (user guide and preferences)
- [ ] Code reviewed and approved
- [ ] Performance verified (< 500ms auto-save)
- [ ] Status bar notification works
