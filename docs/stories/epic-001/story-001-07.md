# Story 001-07: Delete objects with Delete key or menu

**Epic:** EPIC-001 - Core Drawing and Editing Tools
**Status:** Completed
**Estimate:** 3 points
**Actual:** 3 points
**Assigned To:** dev

---

## Description

As a pattern designer, I want to delete selected objects
so that I can remove unwanted elements from my pattern.

---

## Acceptance Criteria

- [x] User can delete selected objects with Delete or Backspace key
- [x] User can delete via Edit menu → Delete
- [x] Deletion shows confirmation dialog if deleting many objects (>10)
- [x] Delete operation is undoable (objects can be restored with Ctrl+Z)
- [x] Deleting objects updates layer object count display
- [x] Dependencies are handled gracefully:
  - Constraints referencing deleted objects are removed or marked invalid (deferred to Epic-002)
  - Parameters referencing deleted geometry show warning (deferred to Epic-002)
- [x] Deleted objects are removed from canvas immediately
- [x] Selection is cleared after deletion

## Implementation Status

**Files Implemented:**
- `/src/core/Commands.h/cpp` - RemoveObjectCommand, RemoveObjectsCommand:
  - Undo-able deletion via QUndoCommand
  - Objects removed from document, stored in command
- `/src/core/Document.h/cpp` - removeObject(), removeObjects() methods
- `/src/ui/MainWindow.cpp` - onEditDelete() with confirmation dialog
- `/src/tools/SelectTool.cpp` - Delete key handler with confirmation dialog
- `/src/ui/LayersPanel.cpp` - Layer object count display and auto-update

**Implemented Features:**
- Delete key and Backspace key support
- Edit menu → Delete action with keyboard shortcut
- Confirmation dialog for bulk delete (>10 objects) in both keyboard and menu paths
- Undo support: RemoveObjectsCommand for batch deletion
- Canvas updates: Document signals trigger redraw
- Selection cleared after removal
- Layer object count shown as "LayerName (count)" format
- Layer counts auto-update when objects added/removed

**Deferred:**
- Dependency handling (constraints/parameters) - will be implemented in Epic-002 when parametric system is added

**All acceptance criteria met for current feature scope.**

---

## Technical Notes

- Implement DeleteObjectsCommand for undo/redo
- Store deleted objects in command for undo restoration
- Handle dependency cleanup:
  - Remove constraints involving deleted objects
  - Update parameter dependencies
  - Notify affected systems (parametric engine, constraint solver)
- Implement confirmation dialog for bulk delete (QMessageBox)
- Remove objects from layer and scene:
  ```cpp
  layer->removeObject(object);
  scene->removeItem(object->graphicsItem());
  ```
- Don't actually delete objects until undo history is cleared (keep for undo)
- Use smart pointers to manage object lifecycle

**Confirmation Dialog:**
```
"Delete 15 objects?"
This action can be undone.
[Cancel] [Delete]
```

---

## Dependencies

- story-001-03: Selection system
- story-008-08: Undo/redo system
- Layer system (story-008-09)

---

## Definition of Done

- [ ] Code implemented and peer reviewed
- [ ] Delete via keyboard and menu working
- [ ] Confirmation dialog for bulk delete
- [ ] Undo/redo working (objects restored)
- [ ] Dependencies cleaned up properly
- [ ] Layer counts updated
- [ ] Unit tests for delete command
- [ ] Integration tests for deletion
- [ ] Documentation updated
- [ ] Merged to main branch
