# Story 005-02: Manual placement with grid and snapping

**Epic:** EPIC-005 - Layout, Nesting, and Isolation
**Status:** Not Started
**Estimate:** 8 points
**Assigned To:** Unassigned

---

## Description

As a pattern designer, I want to manually place pattern pieces on layout with grid and snapping
so that I can position pieces precisely.

---

## Acceptance Criteria

- [ ] Grid overlay can be toggled on/off (G key)
- [ ] Grid spacing is configurable (default: 10mm)
- [ ] Snap-to-grid can be enabled/disabled (Ctrl+Shift+G)
- [ ] Smart guides show when piece edges align with other pieces or sheet boundaries
- [ ] Smart guides show: edge-to-edge, center-to-center, equal spacing
- [ ] Snap distance is configurable (default: 2-5mm depending on zoom)
- [ ] Pieces can be placed using spacebar grab-and-move
- [ ] Ruler indicators show measurements along sheet edges

---

## Technical Notes

**Grid Rendering:**
```cpp
class GridOverlay : public QGraphicsItem {
    double spacing;
    bool visible;

    void paint(QPainter* painter, ...) override {
        if (!visible) return;

        QRectF viewport = scene()->sceneRect();

        // Draw grid lines
        painter->setPen(QPen(QColor(200, 200, 200), 0.5));

        // Vertical lines
        for (double x = 0; x <= viewport.width(); x += spacing) {
            painter->drawLine(QPointF(x, 0),
                            QPointF(x, viewport.height()));
        }

        // Horizontal lines
        for (double y = 0; y <= viewport.height(); y += spacing) {
            painter->drawLine(QPointF(0, y),
                            QPointF(viewport.width(), y));
        }
    }
};
```

**Snap-to-Grid:**
```cpp
Point2D snapToGrid(const Point2D& point, double spacing) {
    return Point2D(
        std::round(point.x / spacing) * spacing,
        std::round(point.y / spacing) * spacing
    );
}
```

**Smart Guides:**
```cpp
class SmartGuides {
    std::vector<Pattern*> allPatterns;
    Pattern* movingPattern;

    struct Guide {
        Line line;
        QString type;  // "edge", "center", "spacing"
    };

    std::vector<Guide> detectGuides(const QPointF& currentPos) {
        std::vector<Guide> guides;

        QRectF movingBounds = movingPattern->boundingRect();
        movingBounds.translate(currentPos);

        for (Pattern* other : allPatterns) {
            if (other == movingPattern) continue;

            QRectF otherBounds = other->boundingRect();

            // Edge-to-edge alignment
            if (std::abs(movingBounds.left() - otherBounds.right()) < snapDistance) {
                guides.push_back({
                    Line::vertical(otherBounds.right()),
                    "edge"
                });
            }

            // Center-to-center alignment
            if (std::abs(movingBounds.center().x() - otherBounds.center().x()) < snapDistance) {
                guides.push_back({
                    Line::vertical(otherBounds.center().x()),
                    "center"
                });
            }

            // Similar checks for top, bottom, vertical center
        }

        return guides;
    }
};
```

**Rulers:**
- Draw rulers along top and left edges of sheet
- Show major and minor tick marks
- Display measurements in current units
- Highlight ruler position under cursor

---

## Dependencies

- story-005-01: Layout sheets
- story-001-04: Spacebar grab-and-move

---

## Definition of Done

- [ ] Grid overlay implemented and toggleable
- [ ] Grid spacing configurable
- [ ] Snap-to-grid working
- [ ] Smart guides detection working
- [ ] Smart guides rendering (temporary lines)
- [ ] Snap distance configurable
- [ ] Integration with spacebar grab-and-move
- [ ] Rulers implemented
- [ ] Unit tests for snap calculations
- [ ] Integration tests
- [ ] Documentation updated
- [ ] Merged to main branch
