# Story 002-05: Apply distance constraints between objects

**Epic:** EPIC-002 - Parametric Design and Constraint System
**Status:** Not Started
**Estimate:** 8 points
**Assigned To:** Unassigned

---

## Description

As a pattern designer, I want to constrain distances between points or lines
so that dimensions remain fixed even when I move objects.

---

## Acceptance Criteria

- [ ] User can add distance constraint between two points
- [ ] User can add distance constraint between point and line
- [ ] User can specify constraint value (fixed distance in current units)
- [ ] Constraint is visually indicated (dimension line, lock icon)
- [ ] Moving constrained objects maintains constraint (solver adjusts geometry)
- [ ] User can remove constraints (right-click or panel)
- [ ] Constraints are saved with project and restored on load
- [ ] Over-constrained situations are detected and reported

---

## Technical Notes

**Constraint Class Hierarchy:**
```cpp
class Constraint {
protected:
    QString id;
    std::vector<GeometryObject*> objects;

public:
    virtual double evaluate() const = 0;  // Returns error (0 = satisfied)
    virtual void computeGradient(Eigen::VectorXd& grad) = 0;
    virtual QString description() const = 0;
};

class DistanceConstraint : public Constraint {
    Point2D* point1;
    Point2D* point2;
    double targetDistance;

public:
    double evaluate() const override {
        double actualDistance = point1->distanceTo(*point2);
        return actualDistance - targetDistance;  // Error
    }
};

class PointLineDistanceConstraint : public Constraint {
    Point2D* point;
    Line* line;
    double targetDistance;

    double evaluate() const override {
        double actualDistance = line->distanceToPoint(*point);
        return actualDistance - targetDistance;
    }
};
```

**UI for Creating Constraints:**
- Add "Constrain Distance" tool to toolbar
- User clicks two points or point + line
- Dialog appears to enter distance value
- Constraint is created and visualized

**Visual Representation:**
- Draw dimension line between constrained objects
- Show lock icon to indicate constraint
- Use distinct color (e.g., blue) for constraint indicators
- Show constraint value as text label

**Constraint Management Panel:**
- List all constraints in project
- Show constraint type, objects involved, target value
- Allow editing constraint value
- Allow deleting constraints

---

## Dependencies

- Geometry objects implemented (story-001-01)
- Constraint solver will use this (story-002-08)

---

## Definition of Done

- [ ] Constraint class hierarchy implemented
- [ ] Distance constraints working (point-point, point-line)
- [ ] Constraint creation UI working
- [ ] Visual indicators rendered
- [ ] Constraints saved/loaded
- [ ] Unit tests for constraint evaluation
- [ ] Integration tests for UI
- [ ] Documentation updated
- [ ] Merged to main branch
