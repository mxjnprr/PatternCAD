# Story 007-01: Design and implement native JSON file format

**Epic:** EPIC-007 - File Operations and Interoperability
**Status:** Not Started
**Estimate:** 5 points
**Assigned To:** Unassigned

---

## Description

As a developer, I need to design a native file format for saving complete project state
so that all data (geometry, parameters, constraints, settings) can be persisted.

---

## Acceptance Criteria

- [ ] File format is JSON-based for readability and debuggability
- [ ] Format includes version number for future compatibility
- [ ] Format stores: metadata, settings, parameters, layers, patterns, geometry, constraints
- [ ] Format is documented with specification
- [ ] Format supports forward/backward compatibility strategy
- [ ] File extension: .patterncad

---

## Technical Notes

**JSON Schema Example:**
```json
{
  "format": "PatternCAD Project",
  "version": "1.0",
  "created": "2026-01-15T14:30:00Z",
  "modified": "2026-01-20T09:15:00Z",
  "author": "",

  "project": {
    "name": "Shirt Pattern",
    "unit": "cm",
    "grid_spacing": 10.0
  },

  "layers": [
    {
      "id": "layer-1",
      "name": "Pattern Pieces",
      "visible": true,
      "locked": false,
      "color": "#000000"
    }
  ],

  "parameters": {
    "chest_width": 50.0,
    "waist_width": 45.0,
    "shoulder_length": 15.0
  },

  "patterns": [
    {
      "id": "pattern-1",
      "name": "Front Panel",
      "layer_id": "layer-1",
      "geometry": [ ... ],
      "constraints": [ ... ],
      "seam_allowance": { ... },
      "notches": [ ... ]
    }
  ]
}
```

**Serialization:**
```cpp
class NativeFormat {
public:
    static bool exportFile(const QString& filepath, const Project* project) {
        QJsonObject root;

        // Format metadata
        root["format"] = "PatternCAD Project";
        root["version"] = "1.0";
        root["created"] = project->createdDate().toString(Qt::ISODate);
        root["modified"] = QDateTime::currentDateTime().toString(Qt::ISODate);

        // Project settings
        root["project"] = serializeProject(project);

        // Layers
        root["layers"] = serializeLayers(project->layers());

        // Parameters
        root["parameters"] = serializeParameters(project->parameters());

        // Patterns
        root["patterns"] = serializePatterns(project->patterns());

        // Write to file
        QJsonDocument doc(root);
        return writeJsonToFile(filepath, doc);
    }
};
```

**Version Compatibility Strategy:**
- Use semantic versioning: MAJOR.MINOR.PATCH
- MAJOR change: Breaking format changes (require migration)
- MINOR change: Additive changes (backward compatible)
- PATCH change: Bug fixes, no format change

**Format Specification Document:**
- Create docs/file-format-spec.md
- Document all JSON fields and their types
- Provide example files
- Document migration strategy

---

## Dependencies

None (foundational)

---

## Definition of Done

- [ ] JSON schema designed
- [ ] Format specification document written
- [ ] File extension (.patterncad) defined
- [ ] Versioning strategy documented
- [ ] Example files created
- [ ] Reviewed by team
- [ ] Documentation updated
- [ ] Merged to main branch
