# Story 005-03: Lock pieces in place

**Epic:** EPIC-005 - Layout, Nesting, and Isolation
**Status:** Not Started
**Estimate:** 3 points
**Assigned To:** Unassigned

---

## Description

As a pattern designer, I want to lock pieces in place on layout
so that they don't move accidentally while I arrange other pieces.

---

## Acceptance Criteria

- [ ] User can lock individual pieces (right-click → Lock)
- [ ] Locked pieces are visually indicated (lock icon or different color)
- [ ] Locked pieces cannot be moved or selected
- [ ] User can unlock pieces (right-click → Unlock)
- [ ] User can lock/unlock all pieces with single command
- [ ] Lock state is saved with project

---

## Technical Notes

**Pattern Lock State:**
```cpp
class Pattern {
    bool locked = false;

public:
    void setLocked(bool lock) {
        locked = lock;
        emit lockStateChanged(locked);
    }

    bool isLocked() const {
        return locked;
    }
};

class PatternGraphicsItem : public QGraphicsItem {
    Pattern* pattern;

    void paint(QPainter* painter, ...) override {
        // Normal pattern rendering
        renderPattern(painter);

        // If locked, draw lock indicator
        if (pattern->isLocked()) {
            QRectF bounds = boundingRect();
            QPointF lockIconPos = bounds.topRight() + QPointF(-20, 5);

            // Draw lock icon
            painter->drawPixmap(lockIconPos, lockIcon);

            // Optional: Draw locked outline
            painter->setPen(QPen(QColor(255, 100, 100), 2, Qt::DashLine));
            painter->drawRect(bounds);
        }
    }

    bool isSelectable() const {
        return !pattern->isLocked();
    }

    bool isMovable() const {
        return !pattern->isLocked();
    }
};
```

**Lock/Unlock Commands:**
```cpp
class LockPatternsCommand : public Command {
    std::vector<Pattern*> patterns;
    bool lock;

    void execute() override {
        for (Pattern* pattern : patterns) {
            pattern->setLocked(lock);
        }
    }

    void undo() override {
        for (Pattern* pattern : patterns) {
            pattern->setLocked(!lock);
        }
    }
};
```

**UI Integration:**
- Right-click context menu on pattern:
  - "Lock" (if unlocked)
  - "Unlock" (if locked)
- Edit menu:
  - "Lock Selected" (Ctrl+L)
  - "Unlock Selected" (Ctrl+Shift+L)
  - "Lock All"
  - "Unlock All"

**Selection Behavior:**
- Locked patterns cannot be selected by clicking
- Locked patterns not included in marquee selection
- If a pattern is selected and then locked, it remains selected but can't be moved

---

## Dependencies

- story-005-02: Layout placement

---

## Definition of Done

- [ ] Lock state property added to Pattern
- [ ] Visual lock indicator rendered
- [ ] Lock prevents selection and movement
- [ ] Lock/Unlock commands implemented
- [ ] UI integration (context menu, keyboard shortcuts)
- [ ] Lock All / Unlock All working
- [ ] Lock state saved/loaded
- [ ] Undo/redo working
- [ ] Unit tests
- [ ] Integration tests
- [ ] Documentation updated
- [ ] Merged to main branch
