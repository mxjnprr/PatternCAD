# Story 006-04: Unit system conversion

**Epic:** EPIC-006 - Measurement and Dimensioning
**Status:** Not Started
**Estimate:** 3 points
**Assigned To:** Unassigned

---

## Description

As a pattern designer, I want to switch between metric and imperial units
so that I can work in my preferred measurement system.

---

## Acceptance Criteria

- [ ] User can set default unit system in preferences: mm, cm, inches
- [ ] All measurements display in current unit system
- [ ] Switching units converts all displayed values automatically
- [ ] Precision is preserved during conversion
- [ ] Parameters, dimensions, measurements all update to new units
- [ ] Grid spacing updates to new units

---

## Technical Notes

**Unit Enum:**
```cpp
enum class Unit {
    Millimeters,
    Centimeters,
    Inches
};
```

**Conversion Functions:**
```cpp
class UnitConverter {
public:
    static double toBaseUnit(double value, Unit from) {
        // Convert to millimeters (base unit)
        switch (from) {
            case Unit::Millimeters:
                return value;
            case Unit::Centimeters:
                return value * 10.0;
            case Unit::Inches:
                return value * 25.4;
        }
    }

    static double fromBaseUnit(double value, Unit to) {
        // Convert from millimeters to target unit
        switch (to) {
            case Unit::Millimeters:
                return value;
            case Unit::Centimeters:
                return value / 10.0;
            case Unit::Inches:
                return value / 25.4;
        }
    }

    static double convert(double value, Unit from, Unit to) {
        double baseValue = toBaseUnit(value, from);
        return fromBaseUnit(baseValue, to);
    }

    static QString formatDistance(double value, Unit unit) {
        QString suffix;
        switch (unit) {
            case Unit::Millimeters:
                suffix = " mm";
                break;
            case Unit::Centimeters:
                suffix = " cm";
                break;
            case Unit::Inches:
                suffix = " in";
                break;
        }

        return QString("%1%2").arg(value, 0, 'f', 2).arg(suffix);
    }

    static QString formatArea(double value, Unit unit) {
        QString suffix;
        switch (unit) {
            case Unit::Millimeters:
                suffix = " mm²";
                break;
            case Unit::Centimeters:
                suffix = " cm²";
                break;
            case Unit::Inches:
                suffix = " in²";
                break;
        }

        return QString("%1%2").arg(value, 0, 'f', 2).arg(suffix);
    }
};
```

**Project Unit Setting:**
```cpp
class Project {
    Unit currentUnit = Unit::Centimeters;

public:
    void setUnit(Unit unit) {
        if (unit == currentUnit) return;

        currentUnit = unit;
        emit unitChanged(unit);

        // Trigger UI refresh
        updateAllDisplays();
    }

    Unit getUnit() const {
        return currentUnit;
    }
};
```

**UI Updates on Unit Change:**
- All measurement labels refresh
- All parameter input fields update
- Grid spacing recalculates
- Ruler tick marks update
- Measurement panel updates

**Preferences Dialog:**
```
┌─ Preferences ──────────────────────┐
│ Units:                              │
│   ○ Millimeters (mm)               │
│   ● Centimeters (cm)               │
│   ○ Inches (in)                    │
│                                     │
│ [Save] [Cancel]                    │
└─────────────────────────────────────┘
```

**Internal Storage:**
- All values stored internally in millimeters (base unit)
- Convert to display unit only when rendering
- Avoids precision loss from repeated conversions

---

## Dependencies

None (standalone feature, but affects all measurement features)

---

## Definition of Done

- [ ] Unit enum and converter implemented
- [ ] Project unit setting working
- [ ] All UI displays update when unit changes
- [ ] Conversion functions accurate
- [ ] Formatting functions working
- [ ] Preferences dialog implemented
- [ ] Grid spacing updates
- [ ] No precision loss
- [ ] Unit tests for conversions
- [ ] Integration tests
- [ ] Documentation updated
- [ ] Merged to main branch
