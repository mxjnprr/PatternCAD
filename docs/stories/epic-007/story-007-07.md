# Story 007-07: Export to DXF format

**Epic:** EPIC-007 - File Operations and Interoperability
**Status:** Not Started
**Estimate:** 13 points
**Assigned To:** Unassigned

---

## Description

As a pattern designer, I want to export patterns to DXF format so that I can use them in other CAD tools or send to cutting machines.

---

## Acceptance Criteria

- [ ] User can export to DXF via File → Export → DXF
- [ ] Export to DXF R12 for maximum compatibility
- [ ] Exported entities: LINE, CIRCLE, ARC, POLYLINE, SPLINE as appropriate
- [ ] Export preserves layer structure and names
- [ ] Export handles units correctly (user specifies: mm, cm, inches)
- [ ] User can choose which layers to export
- [ ] Export produces clean geometry without duplicates
- [ ] Bezier curves converted to DXF SPLINE entities
- [ ] Export tested with AutoCAD, QCAD, LibreCAD

---

## Technical Notes

### Implementation Details

- Implement DXF R12 writer using libdxfrw or custom
- Map PatternCAD geometry to DXF entities
- Handle layer export
- Convert bezier curves to splines
- Set correct units in DXF header
- Test compatibility with target tools

### Geometry Mapping

| PatternCAD Geometry | DXF Entity |
|---------------------|------------|
| Line | LINE |
| Circle | CIRCLE |
| Arc | ARC |
| Rectangle | POLYLINE (closed) |
| Polyline | POLYLINE or LWPOLYLINE |
| CubicBezier | SPLINE |
| Point | POINT |

### DXF Structure

The exported DXF file should contain:
1. HEADER section with units ($INSUNITS)
2. TABLES section with layer definitions
3. ENTITIES section with geometry
4. Proper section markers and EOF

### Layer Export

- Export all layers with original names
- Preserve layer visibility state (optional)
- Map layer colors to DXF color indices
- Allow user to select which layers to export

### Unit Handling

- Set $INSUNITS based on user selection
- Scale all coordinates to target units
- Ensure precision is maintained

### Quality Assurance

- Test exported DXF files open correctly in:
  - AutoCAD
  - QCAD
  - LibreCAD
  - Various CNC/cutting machine software
- Verify geometry accuracy
- Check that no entities are missing or duplicated

---

## Dependencies

None

---

## Definition of Done

- [ ] Code implemented and follows project coding standards
- [ ] Unit tests written and passing for DXF generation
- [ ] Integration tests verify export with sample projects
- [ ] Manual testing completed on Linux and Windows
- [ ] Exported files tested in AutoCAD, QCAD, LibreCAD
- [ ] All geometry types export correctly
- [ ] Layer structure preserved
- [ ] Unit conversion works accurately
- [ ] No duplicate or missing entities
- [ ] Bezier curves convert correctly to splines
- [ ] Documentation updated (user guide, export formats)
- [ ] Code reviewed and approved
- [ ] Compatibility verified with target applications
