# Story 006-02: Measure angles between lines

**Epic:** EPIC-006 - Measurement and Dimensioning
**Status:** Not Started
**Estimate:** 3 points
**Assigned To:** Unassigned

---

## Description

As a pattern designer, I want to measure angles between lines or at vertices
so that I can verify angular relationships.

---

## Acceptance Criteria

- [ ] User can measure angle between two lines (3-point angle: vertex + 2 points)
- [ ] User can measure angle at any vertex automatically
- [ ] Angle displays in degrees with decimal precision
- [ ] Option to display in radians if needed
- [ ] Angle arc is rendered visually

---

## Technical Notes

**Angle Measurement:**
```cpp
class AngleMeasurement : public Measurement {
    Point2D vertex;
    Point2D point1;
    Point2D point2;
    double angleRadians;

    AngleMeasurement(Point2D v, Point2D p1, Point2D p2)
        : vertex(v), point1(p1), point2(p2) {

        // Calculate angle using vectors
        Vector2D vec1 = (point1 - vertex).normalized();
        Vector2D vec2 = (point2 - vertex).normalized();

        // Angle between vectors
        double dot = vec1.dot(vec2);
        angleRadians = std::acos(std::clamp(dot, -1.0, 1.0));
    }

    double getAngleDegrees() const {
        return angleRadians * 180.0 / M_PI;
    }

    QString getDisplayValue() const {
        if (useDegrees) {
            return QString("%1Â°").arg(getAngleDegrees(), 0, 'f', 1);
        } else {
            return QString("%1 rad").arg(angleRadians, 0, 'f', 3);
        }
    }

    void render(QPainter& painter) {
        // Draw angle arc
        double radius = 30.0;  // pixels
        double startAngle = (point1 - vertex).angle();
        double sweepAngle = angleRadians;

        painter.setPen(QPen(Qt::green, 1));
        painter.drawArc(QRectF(vertex.x - radius, vertex.y - radius,
                              2*radius, 2*radius),
                       startAngle * 16, sweepAngle * 16);

        // Draw angle label
        double labelAngle = startAngle + sweepAngle / 2.0;
        Point2D labelPos = vertex + Point2D::fromPolar(radius + 15, labelAngle);
        painter.drawText(labelPos, getDisplayValue());
    }
};
```

**MeasureTool Extension:**
- Add angle measurement mode (toggle with A key)
- Click 3 points: vertex, then two points defining angle
- Or click on existing vertex to measure angle automatically

**Automatic Vertex Angle:**
- Detect vertex by clicking on point where two edges meet
- Automatically calculate angle between incident edges

---

## Dependencies

- story-006-01: Measure tool foundation

---

## Definition of Done

- [ ] AngleMeasurement class implemented
- [ ] 3-point angle measurement working
- [ ] Automatic vertex angle detection
- [ ] Angle arc rendering
- [ ] Degrees and radians display options
- [ ] Integration with MeasureTool
- [ ] Unit tests for angle calculations
- [ ] Integration tests
- [ ] Documentation updated
- [ ] Merged to main branch
