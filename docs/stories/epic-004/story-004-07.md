# Story 004-07: Duplicate and copy patterns

**Epic:** EPIC-004 - Professional Pattern Features
**Status:** Not Started
**Estimate:** 3 points
**Assigned To:** Unassigned

---

## Description

As a pattern designer, I want to duplicate existing patterns
so that I can create variations or mirror pieces.

---

## Acceptance Criteria

- [ ] User can duplicate pattern via menu or Ctrl+D
- [ ] Duplicated pattern is copy with all geometry, parameters, constraints
- [ ] Duplicated pattern has unique name (e.g., "Pattern 1 Copy")
- [ ] User can choose whether to link parameters to original
- [ ] Duplication is undoable

---

## Technical Notes

**Pattern::clone() Method:**
```cpp
class Pattern {
public:
    Pattern* clone() const {
        Pattern* copy = new Pattern();
        copy->setName(name + " Copy");

        // Deep copy all geometry
        for (GeometryObject* obj : geometryObjects) {
            copy->addGeometry(obj->clone());
        }

        // Deep copy parameters
        for (const auto& [name, value] : parameters) {
            copy->setParameter(name, value);
        }

        // Deep copy constraints
        for (Constraint* constraint : constraints) {
            copy->addConstraint(constraint->clone());
        }

        // Copy seam allowance settings
        if (hasSeamAllowance()) {
            copy->setSeamAllowance(seamAllowance->clone());
        }

        // Copy notches
        for (Notch* notch : notches) {
            copy->addNotch(notch->clone());
        }

        // Copy match points
        for (MatchPoint* mp : matchPoints) {
            copy->addMatchPoint(mp->clone());
        }

        return copy;
    }
};
```

**DuplicatePatternCommand:**
```cpp
class DuplicatePatternCommand : public Command {
    Pattern* originalPattern;
    Pattern* duplicatedPattern;
    bool linkParameters;

    void execute() override {
        duplicatedPattern = originalPattern->clone();

        // Generate unique name
        QString baseName = originalPattern->name();
        int copyNumber = 1;
        QString newName;

        do {
            newName = QString("%1 Copy %2").arg(baseName).arg(copyNumber++);
        } while (project->hasPatternNamed(newName));

        duplicatedPattern->setName(newName);

        // Optional: Link parameters
        if (linkParameters) {
            duplicatedPattern->linkParametersTo(originalPattern);
        }

        project->addPattern(duplicatedPattern);
    }

    void undo() override {
        project->removePattern(duplicatedPattern);
        delete duplicatedPattern;
        duplicatedPattern = nullptr;
    }
};
```

**Parameter Linking (Optional):**
- If enabled, duplicated pattern's parameters reference original
- When original parameter changes, duplicates update automatically
- Useful for creating pattern variants that share base dimensions

---

## Dependencies

None (uses existing Pattern infrastructure)

---

## Definition of Done

- [ ] Pattern::clone() implemented
- [ ] DuplicatePatternCommand implemented
- [ ] Deep copy of all pattern features working
- [ ] Unique name generation working
- [ ] Optional parameter linking implemented
- [ ] UI integration (menu, Ctrl+D shortcut)
- [ ] Undo/redo working
- [ ] Unit tests for cloning
- [ ] Integration tests
- [ ] Documentation updated
- [ ] Merged to main branch
