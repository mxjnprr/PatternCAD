# Story 001-04: Spacebar grab-and-move interaction

**Epic:** EPIC-001 - Core Drawing and Editing Tools
**Status:** Not Started
**Estimate:** 8 points
**Assigned To:** Unassigned

---

## Description

As a pattern designer, I want to use spacebar to grab and move pieces with real-time visual feedback
so that I can quickly reposition pattern pieces without switching tools.

**Critical Feature:** This is a unique UX feature specifically requested for efficient pattern piece manipulation.

---

## Acceptance Criteria

- [ ] When mouse hovers over a piece, pressing spacebar enters grab mode
- [ ] In grab mode, the piece is selected and follows mouse movement in real-time
- [ ] The moving piece is fully visible at all times (not just outline)
- [ ] Pressing spacebar again drops the piece at current mouse position
- [ ] Pressing Escape during move cancels and returns piece to original position
- [ ] Grab-and-move works for single pieces and groups
- [ ] Performance: < 16ms latency (60fps) during movement
- [ ] Pieces can be placed over other pieces (superposition allowed for comparison)
- [ ] Works regardless of which tool is currently active
- [ ] Visual cursor change indicates grab mode is possible (hover over piece)

---

## Technical Notes

**State Machine:**
```
Idle → (Hover + Spacebar) → GrabMode → (Mouse Move) → Moving → (Spacebar) → Drop
                                    ↓
                                (Escape) → Cancel → Idle
```

**Implementation Approach:**
- Implement GrabMoveInteraction state machine class
- Add spacebar event handling to canvas (keyPressEvent)
- Implement hover detection using QGraphicsItem::hoverEnterEvent/hoverLeaveEvent
- Enable hover events: setAcceptHoverEvents(true)
- During move, update item position on every mouseMoveEvent
- Store original position for cancel operation
- Optimize rendering for smooth 60fps movement (no unnecessary repaints)
- Handle coordinate transforms correctly (view to scene coordinates)
- Create MoveObjectsCommand for undo when piece is dropped

**Performance Critical:**
- Must maintain 60fps during drag
- Use QGraphicsItem::setPos() directly (efficient)
- Avoid scene invalidation on every move
- Test with 100+ objects in scene

**Edge Cases:**
- Handle hover when multiple items overlap (pick top item)
- Handle grab when item is on locked layer (don't allow)
- Handle grab when nothing is under cursor (show "no item" cursor)

---

## Dependencies

- story-001-03: Selection system must be implemented
- Undo/redo system (story-008-08) for move commands

---

## Definition of Done

- [ ] Code implemented and peer reviewed
- [ ] State machine working correctly
- [ ] Spacebar interaction smooth and intuitive
- [ ] Full piece visibility during move
- [ ] Cancel with Escape works
- [ ] Performance tested: 60fps with 100+ objects
- [ ] Unit tests for state machine
- [ ] Integration tests for interaction
- [ ] User testing validates UX
- [ ] Documentation updated
- [ ] Merged to main branch
