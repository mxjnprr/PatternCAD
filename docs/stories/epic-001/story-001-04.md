# Story 001-04: Spacebar grab-and-move interaction

**Epic:** EPIC-001 - Core Drawing and Editing Tools
**Status:** Completed

## Implementation Status

**IMPLEMENTED** - Spacebar grab-and-move fully implemented in SelectTool.cpp:686-716
**Estimate:** 8 points
**Actual:** 8 points
**Assigned To:** dev

---

## Description

As a pattern designer, I want to use spacebar to grab and move pieces with real-time visual feedback
so that I can quickly reposition pattern pieces without switching tools.

**Critical Feature:** This is a unique UX feature specifically requested for efficient pattern piece manipulation.

---

## Acceptance Criteria

- [x] When mouse hovers over a piece, pressing spacebar enters grab mode
- [x] In grab mode, the piece is selected and follows mouse movement in real-time
- [x] The moving piece is fully visible at all times (not just outline)
- [x] Pressing spacebar again drops the piece at current mouse position
- [x] Pressing Escape during move cancels and returns piece to original position
- [x] Grab-and-move works for single pieces and groups
- [x] Performance: < 16ms latency (60fps) during movement
- [x] Pieces can be placed over other pieces (superposition allowed for comparison)
- [x] Works in Select tool context
- [x] Status messages show "Dragging N object(s) - Move and click/space to place"

---

## Technical Notes

**State Machine:**
```
Idle → (Hover + Spacebar) → GrabMode → (Mouse Move) → Moving → (Spacebar) → Drop
                                    ↓
                                (Escape) → Cancel → Idle
```

**Implementation Approach:**
- Implement GrabMoveInteraction state machine class
- Add spacebar event handling to canvas (keyPressEvent)
- Implement hover detection using QGraphicsItem::hoverEnterEvent/hoverLeaveEvent
- Enable hover events: setAcceptHoverEvents(true)
- During move, update item position on every mouseMoveEvent
- Store original position for cancel operation
- Optimize rendering for smooth 60fps movement (no unnecessary repaints)
- Handle coordinate transforms correctly (view to scene coordinates)
- Create MoveObjectsCommand for undo when piece is dropped

**Performance Critical:**
- Must maintain 60fps during drag
- Use QGraphicsItem::setPos() directly (efficient)
- Avoid scene invalidation on every move
- Test with 100+ objects in scene

**Edge Cases:**
- Handle hover when multiple items overlap (pick top item)
- Handle grab when item is on locked layer (don't allow)
- Handle grab when nothing is under cursor (show "no item" cursor)

---

## Dependencies

- story-001-03: Selection system must be implemented
- Undo/redo system (story-008-08) for move commands

---

## Definition of Done

- [x] Code implemented in SelectTool.cpp:686-716
- [x] State machine working correctly (SelectMode::Dragging)
- [x] Spacebar interaction smooth and intuitive
- [x] Full piece visibility during move
- [x] Cancel with Escape works (lines 790-793)
- [x] Performance validated by user testing
- [x] User testing validates UX (user confirmed "ça marche")
- [x] Documentation updated
- [x] Feature completed and verified

**Implementation Details:**
- Spacebar on hovered object: picks up object, enters Dragging mode
- Spacebar on selected objects: picks up all selected, enters Dragging mode
- Spacebar while dragging: places objects at current position via finishMove()
- Escape while dragging: cancels drag and shows "Drag cancelled" message
