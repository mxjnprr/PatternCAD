# Story 008-02: Implement canvas with pan and zoom

**Epic:** EPIC-008 - User Interface and Cross-Platform Foundation
**Status:** Not Started
**Estimate:** 5 points
**Assigned To:** Unassigned

---

## Description

As a pattern designer, I want a canvas where I can view and edit patterns with smooth pan and zoom
so that I can work at different scales and navigate large patterns.

---

## Acceptance Criteria

- [ ] Central widget is canvas (QGraphicsView + QGraphicsScene)
- [ ] User can pan by middle-mouse drag, two-finger trackpad, or Hand tool (H)
- [ ] User can zoom with mouse wheel, pinch gesture, or keyboard (+/-)
- [ ] Zoom range: 10% to 1000% with smooth interpolation
- [ ] Zoom to Fit All (F key) frames all objects
- [ ] Zoom to Selection (Shift+F) frames selected objects
- [ ] Zoom to 100% (Ctrl+0) shows actual size
- [ ] Pan and zoom are smooth (60fps target)
- [ ] Canvas shows origin point (0,0) with visual indicator
- [ ] Canvas displays current zoom percentage in status bar

---

## Technical Notes

**Implementation Details:**
- Implement PatternCanvas (QGraphicsView subclass)
- Implement PatternScene (QGraphicsScene subclass)
- Handle mouse wheel for zoom
- Handle middle-mouse drag for pan
- Implement zoom to fit, zoom to selection
- Optimize rendering for smooth 60fps
- Add origin indicator item

**Key Components:**
```cpp
class PatternCanvas : public QGraphicsView {
    Q_OBJECT
public:
    explicit PatternCanvas(QWidget *parent = nullptr);

    void zoomIn();
    void zoomOut();
    void zoomToFit();
    void zoomToSelection();
    void zoomToActual();
    void setZoom(qreal zoom);
    qreal getZoom() const;

protected:
    void wheelEvent(QWheelEvent *event) override;
    void mousePressEvent(QMouseEvent *event) override;
    void mouseMoveEvent(QMouseEvent *event) override;
    void mouseReleaseEvent(QMouseEvent *event) override;

private:
    PatternScene* scene_;
    qreal currentZoom_;
    bool isPanning_;
    QPoint lastPanPos_;

    static constexpr qreal MIN_ZOOM = 0.1;
    static constexpr qreal MAX_ZOOM = 10.0;
};

class PatternScene : public QGraphicsScene {
    Q_OBJECT
public:
    explicit PatternScene(QObject *parent = nullptr);

private:
    void drawOrigin();
    QGraphicsItem* originItem_;
};
```

**Zoom Implementation:**
- Use QGraphicsView::scale() for zoom
- Center zoom on mouse cursor position
- Smooth zoom with zoom factor = 1.15 per step
- Clamp zoom to MIN_ZOOM (10%) and MAX_ZOOM (1000%)

**Pan Implementation:**
- Middle mouse button drag
- Store drag start position
- Update viewport scroll during drag
- Smooth panning with QGraphicsView scrollbars

**Performance Optimization:**
- Use QGraphicsView::CacheBackground
- Enable OpenGL rendering if available: setViewport(new QOpenGLWidget)
- Implement level-of-detail (LOD) for complex geometry

**Origin Indicator:**
- Draw crosshair at (0, 0)
- Use different color (e.g., red or blue)
- Always visible, scales with zoom

---

## Dependencies

- story-008-01 (Main window must exist to host canvas)

---

## Definition of Done

- [ ] Code implemented and committed
- [ ] Unit tests written and passing
- [ ] Integration tests passing
- [ ] Code reviewed and approved
- [ ] Documentation updated
- [ ] Manual testing completed
- [ ] No critical or high-priority bugs
- [ ] Acceptance criteria verified
- [ ] Performance verified: 60fps during pan/zoom
